"use strict";
/**
 * Form Data Json Converter
 * @link https://github.com/brainfoolong/form-data-json
 * @licence MIT
 */var FormDataJson=function(){function e(){}return e.toJson=function(t,n){n=e.merge(e.defaultOptionsToJson,n);var i=e.getFieldTree(t,(function(t){if("function"==typeof n.inputFilter&&!0!==n.inputFilter(t))return!1;if(!n.includeDisabled&&t.disabled)return!1;var i=(t.type||"text").toLowerCase();return!(!n.includeButtonValues&&(t instanceof HTMLButtonElement||e.buttonInputTypes.indexOf(i)>-1))&&!(void 0===n.uncheckedValue&&1==e.checkedInputTypes.indexOf(i)&&!t.checked)})),r=n.flatList?[]:{},a=[];function u(t){if(e.isObject(t)){var n=0,i=!0;for(var r in t)!e.isObject(t[r])||t[r]instanceof Element||(t[r]=u(t[r])),parseInt(r)!==n&&(i=!1),n++;if(i){var a=[];for(var l in t)a.push(t[l]);return a}}return t}function l(){return n.arrayify&&(r=u(r)),n.skipEmpty&&(r=s(r)||(n.flatList?[]:{})),r}function s(t,i){var r=e.isArray(t),a=r?[]:{},u=0;for(var l in t){var o=t[l];n.flatList&&!i&&(o=o[1]),null!=o&&""!==o&&((e.isObject(o)||e.isArray(o))&&(o=s(o,(i||0)+1)||""),"object"!=typeof o&&""===e.stringify(o)||(r?a.push(n.flatList&&!i?[t[l][0],o]:o):a[l]=o,u++))}return u?a:null}if(function e(t,i){for(var r in t){var u=t[r],l=n.flatList?u.name:r;if("nested"!==u.type){var s=u.input,o=u.inputType;if("file"!==o){var c=null;if("radio"===u.type){for(var f=0;f<u.inputs.length;f++){var p=u.inputs[f];if(p.checked){c=p.value;break}}null===c&&(c=n.uncheckedValue)}else if("checkbox"===o)c=s.value;else if(s instanceof HTMLSelectElement){for(var d=[],v=0;v<s.options.length;v++){var y=s.options[v];y.selected&&d.push((void 0!==y.value?y.value:y.text).toString())}c=s.multiple?d:d.length?d[0]:null}else c=s.value;n.flatList?i.push([u.name,c]):i[l]=c}else n.filesCallback&&a.push({object:i,key:l,input:s})}else n.flatList?e(u.tree,i):(i[r]={},e(u.tree,i[r]))}}(i,r),a.length){for(var o=0,c=0,f=function(){var t=a[p],i=t.object;c+=t.input.files.length;for(var r=function(){var r=t.input.files[u],a=new FileReader;a.onload=function(){t.input.multiple?(e.isArray(i[t.key])||(i[t.key]=[]),i[t.key].push(a.result)):i[t.key]=a.result,++o===c&&n.filesCallback(l())},a[n.fileReaderFunction](r)},u=0;u<t.input.files.length;u++)r()},p=0;p<a.length;p++)f();return null}return n.filesCallback?(n.filesCallback(l()),null):l()},e.fromJson=function(t,n,i,r){if(e.isObject(n)||e.isArray(n)){i=e.merge(e.defaultOptionsFromJson,i);var a=e.getFieldTree(t),u={};i.clearOthers&&e.clear(t),i.resetOthers&&e.reset(t),function t(n,r){if(e.isObject(r)||e.isArray(r))for(var a in n){var l=n[a],s=i.flatList?l.name:a;if("nested"!==l.type)if(i.flatList)for(var o in r){var c=r[o];if(c&&c[0]===l.name&&u[l.name]!==o){u[l.name]=o,e.setInputValue(l,c[1],i.triggerChangeEvent);break}}else void 0!==r[s]&&e.setInputValue(l,r[s]||null,i.triggerChangeEvent);else if(i.flatList)t(l.tree,r);else if("object"==typeof r[s]){var f=r[s],p=l.tree;if(e.isArray(f))for(var d in p={},l.tree){var v=l.tree[d];v.autoIncrementInputs&&"checkbox"===v.input.type.toLowerCase()&&f.indexOf(v.input.value)>-1?v.input.checked=!0:p[d]=v}t(p,f)}}}(a,n)}},e.reset=function(t){!function t(n){for(var i in n){var r=n[i];if("nested"!==r.type)if("radio"!==r.type){if(!(r.inputType&&e.buttonInputTypes.indexOf(r.inputType)>-1)){var a=r.input;if(e.checkedInputTypes.indexOf(r.inputType)>-1)a.checked=a.defaultChecked;else if(a instanceof HTMLSelectElement)for(var u=a.querySelectorAll("option"),l=0;l<u.length;l++){var s=u[l];s.selected=s.defaultSelected}else a.getAttribute("value")?a.value=a.getAttribute("value"):"string"!=typeof a.defaultValue&&"number"!=typeof a.defaultValue||(a.value=a.defaultValue)}}else for(var o=0;o<r.inputs.length;o++){var c=r.inputs[o];c.checked=c.defaultChecked}else t(r.tree)}}(e.getFieldTree(t))},e.clear=function(t){!function t(n){for(var i in n){var r=n[i];"nested"!==r.type?r.input&&e.buttonInputTypes.indexOf(r.inputType)>-1||e.setInputValue(r,null):t(r.tree)}}(e.getFieldTree(t))},e.setInputValue=function(t,n,i){var r=i?function(e){var t=null;"function"==typeof Event?t=new Event("change",{bubbles:!0}):(t=document.createEvent("Event")).initEvent("change",!0,!0),e.dispatchEvent(t)}:null;if("radio"!==t.type){var a=t.input,u=t.inputType;if("file"!==u){var l=!1;if("checkbox"===u)a.addEventListener("click",(function(){!function(e){const t=e.dataset.checkedOff,n=e.dataset.checkedNull,i=e.dataset.checkedOn,r=e.value,a=[t,n,i];let u=a.indexOf(r);(!t&&2==u||!n&&0==u||!i&&1==u)&&u++,m(e,a[(u+1)%a.length])}(this)})),m(a,n);else if(a instanceof HTMLSelectElement){var s=n;null==s?s=[]:e.isObject(s)?s=Object.values(s):e.isArray(s)||(s=[s]);for(var o=0;o<a.options.length;o++){var c=a.options[o],f=(void 0!==c.value?c.value:c.text).toString();!1!==c.selected&&(l=!0),c.selected=!1;for(var p=0;p<s.length;p++)if(f===e.stringify(s[p])){!0!==c.selected&&(l=!0),c.selected=!0;break}}}else a.value!==n&&(l=!0),a.value=n;l&&r&&r(a)}}else{for(var d=[],v=0;v<t.inputs.length;v++){var y=t.inputs[v];if(y.checked&&d.push(y),y.checked=!1,null!==n&&e.stringify(y.value)===e.stringify(n)){y.checked||d.push(y),y.checked=!0;break}}if(r)for(var h in d)r(d[h])}function m(e,t){const n=e.dataset.checkedOn,i=e.dataset.checkedOff,r=e.dataset.checkedNull;switch(t=r||t?t:i){case r:case null:!function(e){e.indeterminate=!0,e.value=e.dataset.checkedNull,e.checked=!0,e.classList.add("minus")}(e);break;case n:!function(e){e.indeterminate=!1,e.value=e.dataset.checkedOn,e.checked=!0,e.classList.remove("minus")}(e);break;case i:!function(e){e.indeterminate=!1,e.value=e.dataset.checkedOff,e.checked=!1,e.classList.remove("minus")}(e)}}},e.stringify=function(e){return void 0===e||"object"==typeof e?"":"boolean"==typeof e?e?"1":"0":e+""},e.getFieldTree=function(t,n){if(!(t=e.getElement(t)))return[];for(var i=t.querySelectorAll("select, textarea, input, button"),r={},a={},u=0;u<i.length;u++){var l=i[u];if(l.name&&0!==l.name.length&&(!n||!0===n(l))){var s=(l.type||"text").toLowerCase(),o=l.name,c=l.name.replace(/\]/g,"").split("["),f="[]"===o.substr(-2);f&&(l instanceof HTMLSelectElement&&l.multiple||"radio"===s)&&c.pop();for(var p=c.length,d=r,v="",y=0;y<p;y++){var h=c[y],m=v?v+"["+h+"]":h;""===h&&(void 0===a[m]&&(a[m]=0),h=a[m].toString(),a[m]++),v=v?v+"["+h+"]":h,p-1===y?"radio"===(l.type||"text").toLowerCase()?(void 0===d[h]&&(d[h]={type:"radio",name:l.name,inputType:s,inputs:[],autoIncrementInputs:0}),f&&(d[h].autoIncrementInputs=1),d[h].inputs.push(l)):d[h]={type:"default",name:l.name,inputType:s,input:l,autoIncrementInputs:f?1:0}:(void 0!==d[h]&&void 0!==d[h].tree||(d[h]={type:"nested",tree:{}}),d=d[h].tree)}}}return r},e.isObject=function(e){return e&&"object"==typeof e&&"[object Array]"!==Object.prototype.toString.call(e)},e.isArray=function(e){return Array.isArray(e)},e.getElement=function(e){return"string"==typeof e?document.querySelector(e):e instanceof HTMLElement?e:"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof $&&e instanceof $?e[0]:(console.warn("FormDataJson: Unsupported element passed. Supported is HTMLElement, a string query selector, JQuery or $ object"),null)},e.merge=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var r in t)n[r]=t[r];return n},e}();FormDataJson.defaultOptionsToJson={includeDisabled:!1,includeButtonValues:!1,uncheckedValue:void 0,inputFilter:null,flatList:!1,skipEmpty:!1,filesCallback:null,fileReaderFunction:"readAsDataURL",arrayify:!0},FormDataJson.defaultOptionsFromJson={flatList:!1,clearOthers:!1,resetOthers:!1,triggerChangeEvent:!1},FormDataJson.buttonInputTypes=["button","submit","reset","image"],FormDataJson.checkedInputTypes=["checkbox","radio"],"undefined"!=typeof module&&module.exports&&(module.exports=FormDataJson);
